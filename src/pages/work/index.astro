---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const projects = await getCollection("work", ({ data }) => {
  return data.draft !== true;
});

// Sort by order field
const sortedProjects = projects.sort((a, b) => {
  const orderA = a.data.order ?? 999;
  const orderB = b.data.order ?? 999;
  return orderA - orderB;
});
---

<BaseLayout title="ARCHIVE.WORK">
  <header class="page-header">
    <h1 class="terminal-prompt">ARCHIVE.WORK</h1>
    <p class="page-description">Selected projects and collaborations.</p>
  </header>

  <hr class="section-divider double-line" />

  <section class="projects-grid">
    {
      sortedProjects.map((project) => (
        <a href={`/work/${project.slug}`} class="project-card-link">
          <article class="project-card">
            {project.data.image && (
              <div class="project-image">
                <img src={project.data.image} alt={project.data.title} loading="lazy" />
              </div>
            )}
            <div class="project-content">
              <h2 class="project-title">
                <span data-text={project.data.title}>{project.data.title}</span>
              </h2>
              <p class="project-description">{project.data.description}</p>
              <div class="project-tags">
                {project.data.tags?.map((tag) => (
                  <span class="project-tag">{tag}</span>
                ))}
              </div>
            </div>
          </article>
        </a>
      ))
    }
  </section>
</BaseLayout>
