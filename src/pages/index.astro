---
import BaseLayout from '../layouts/BaseLayout.astro';
import TypingText from '../components/TypingText.astro';
import { getCollection } from 'astro:content';

// Get latest blog posts
const posts = (await getCollection('blog'))
  .filter(post => !post.data.draft && !post.data.archive)
  .sort((a, b) => {
    const dateA = a.data.date ?? new Date(0);
    const dateB = b.data.date ?? new Date(0);
    return dateB.getTime() - dateA.getTime();
  })
  .slice(0, 3);

// Format date helper
function formatDate(date: Date | undefined): string {
  if (!date) return '----.--.--';
  return date.toISOString().split('T')[0].replace(/-/g, '.');
}

// Work projects (latest 3)
const projects = [
  { title: "Kin Insurance", tags: "Design System lead" },
  { title: "Kin Insurance", tags: "Senior Software Engineer" },
  { title: "Neoteric Design", tags: "Front end dev, & designer" },
];
---

<BaseLayout title="HOME">
  <section class="hero">
    <div class="intro">
      <TypingText
        text="Hey there, I'm Peter."
        tag="h2"
        speed={60}
        delay={300}
        class="hero-title"
      />
      <p class="hero-subtitle terminal-prompt">
        Design Engineer / Pixel Pusher / Leisure Enthusiast
      </p>
    </div>
  </section>

  <hr class="section-divider" />

  <section class="latest-posts">
    <h3 class="section-title">LATEST.DISPATCH</h3>
    <ul class="list-dotted">
      {posts.map((post) => (
        <li>
          <span class="date">[{formatDate(post.data.date)}]</span>
          <span class="title">
            <a href={`/blog/${post.slug}`}>{post.data.title}</a>
          </span>
          <span class="leader"></span>
          <span class="action">
            <a href={`/blog/${post.slug}`}>[->]</a>
          </span>
        </li>
      ))}
    </ul>
    <a href="/blog" class="link-arrow">view all dispatches</a>
  </section>

  <hr class="section-divider" />

  <section class="latest-work">
    <h3 class="section-title">WORK.HISTORY</h3>
    <ul class="list-dotted">
      {projects.map((project) => (
        <li>
          <span class="title">{project.title}</span>
          <span class="leader"></span>
          <span class="action">{project.tags}</span>
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>

<style>
  .hero {
    margin-bottom: var(--space-6);
  }

  .hero-title {
    font-size: var(--font-size-2xl);
    color: var(--accent);
    margin-bottom: var(--space-3);
  }

  .hero-subtitle {
    font-size: var(--font-size-lg);
    color: var(--text-secondary);
  }

  .latest-posts,
  .latest-work {
    margin-bottom: var(--space-5);
  }

  .link-arrow {
    display: inline-block;
    margin-top: var(--space-3);
    font-size: var(--font-size-sm);
  }
</style>
