---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// Get latest blog posts
const posts = (await getCollection("blog"))
  .filter((post) => !post.data.draft && !post.data.archive)
  .sort((a, b) => {
    const dateA = a.data.date ?? new Date(0);
    const dateB = b.data.date ?? new Date(0);
    return dateB.getTime() - dateA.getTime();
  })
  .slice(0, 3);

// Get latest work projects
const projects = (await getCollection("work"))
  .filter((project) => !project.data.draft)
  .sort((a, b) => {
    const orderA = a.data.order ?? 999;
    const orderB = b.data.order ?? 999;
    return orderA - orderB;
  })
  .slice(0, 3);

// Format date helper
function formatDate(date: Date | undefined): string {
  if (!date) return "----.--.--";
  return date.toISOString().split("T")[0].replace(/-/g, ".");
}
---

<BaseLayout title="HOME">
  <section class="hero">
    <div class="intro">
      <h2 class="hero-title">Hey there, I'm Peter.</h2>
      <p class="hero-subtitle terminal-prompt">
        I'm a Design Engineer by trade, and leisure enthusiast by passion. I help bridge designers and engineers by
        speaking their language, and building systems and tools that both can use.
      </p>
    </div>
  </section>

  <hr class="section-divider" />

  <section class="latest-posts">
    <h3 class="section-title">Latest Writing</h3>
    <ul class="list-dotted">
      {
        posts.map((post) => (
          <li>
            <a href={`/blog/${post.slug}`}>
              <span class="date">[{formatDate(post.data.date)}]</span>
              <span class="title">{post.data.title}</span>
            </a>
          </li>
        ))
      }
    </ul>
    <a href="/blog" class="link-arrow">view all</a>
  </section>

  <hr class="section-divider" />

  <section class="latest-work">
    <h3 class="section-title">Recent Work</h3>
    <ul class="list-dotted">
      {
        projects.map((project) => (
          <li>
            <a href={`/work/${project.slug}`}>
              <span class="title">{project.data.title}</span>
              <span class="description">{project.data.description}</span>
            </a>
          </li>
        ))
      }
    </ul>
    <a href="/work" class="link-arrow">view all</a>
  </section>
</BaseLayout>

<style>
  .hero {
    margin-bottom: var(--space-6);
  }

  .hero-title {
    font-size: var(--font-size-2xl);
    color: var(--accent);
    margin-bottom: var(--space-3);
  }

  .hero-subtitle {
    font-size: var(--font-size-lg);
    color: var(--text-secondary);
  }

  .latest-posts,
  .latest-work {
    margin-bottom: var(--space-5);
  }

  .link-arrow {
    display: inline-block;
    margin-top: var(--space-3);
    font-size: var(--font-size-sm);
  }

  .title {
    display: flex;
  }

  .description {
    display: flex;
    font-size: var(--font-size-xs);
  }
</style>
