---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog"))
  .filter((post) => !post.data.draft && !post.data.archive)
  .sort((a, b) => {
    const dateA = a.data.date ?? new Date(0);
    const dateB = b.data.date ?? new Date(0);
    return dateB.getTime() - dateA.getTime();
  });

// Format date helper
function formatDate(date: Date | undefined): string {
  if (!date) return "----.--.--";
  return date.toISOString().split("T")[0].replace(/-/g, ".");
}
---

<BaseLayout title="DISPATCH.LOG">
  <header class="page-header">
    <h1 class="terminal-prompt">DISPATCH.LOG</h1>
    <p class="page-description">Thoughts, notes, and transmissions from the terminal.</p>
  </header>

  <hr class="section-divider double-line" />

  <section class="posts-list">
    <ul class="list-dotted">
      {
        posts.map((post) => (
          <li>
            <span class="date">[{formatDate(post.data.date)}]</span>
            <span class="title">
              <a href={`/blog/${post.slug}`} class="glitch" data-text={post.data.title}>
                {post.data.title}
              </a>
            </span>
            <span class="leader" />
            <span class="action">[READ]</span>
          </li>
        ))
      }
    </ul>
  </section>

  {
    posts.length === 0 && (
      <div class="empty-state">
        <p class="terminal-prompt">NO DISPATCHES FOUND</p>
        <p>Check back later for new transmissions.</p>
      </div>
    )
  }
</BaseLayout>

<style>
  .page-header {
    margin-bottom: var(--space-5);
  }

  .page-header h1 {
    margin-bottom: var(--space-2);
  }

  .page-description {
    color: var(--text-muted);
    font-size: var(--font-size-sm);
  }

  .posts-list {
    margin-top: var(--space-5);
  }

  .empty-state {
    text-align: center;
    padding: var(--space-8) 0;
    color: var(--text-muted);
  }
</style>
